{% extends "base.html" %}

{% block title %}Evaluation Results - Materials GNN{% endblock %}

{% block content %}
<div class="main-content">
    <h1>Evaluation Results</h1>
    
    {% if evaluation_results %}
    <div class="row">
        {% for model_name, results in evaluation_results.items() %}
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>{{ model_name }} Performance</h5>
                </div>
                <div class="card-body">
                    <h6>Energy Above Hull:</h6>
                    <p>
                        MAE: {{ "%.4f"|format(results.energy_mae) }} eV/atom<br>
                        MSE: {{ "%.4f"|format(results.energy_mse) }} eV²/atom²<br>
                        R²: {{ "%.4f"|format(results.energy_r2) }}
                    </p>
                    
                    <h6>Band Gap:</h6>
                    <p>
                        MAE: {{ "%.4f"|format(results.bandgap_mae) }} eV<br>
                        MSE: {{ "%.4f"|format(results.bandgap_mse) }} eV²<br>
                        R²: {{ "%.4f"|format(results.bandgap_r2) }}
                    </p>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    {% if charts %}
    <div class="row mt-4">
        {% if charts.performance_comparison %}
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5>Performance Comparison</h5>
                </div>
                <div class="card-body">
                    <div id="performance-chart"></div>
                </div>
            </div>
        </div>
        {% endif %}
        
        {% if charts.predictions_scatter %}
        <div class="col-12 mt-3">
            <div class="card">
                <div class="card-header">
                    <h5>Predictions vs Actual Values</h5>
                </div>
                <div class="card-body">
                    <div id="scatter-chart"></div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    
    <script>
        {% if charts.performance_comparison %}
        var perfData = {{ charts.performance_comparison|safe }};
        Plotly.newPlot('performance-chart', perfData.data, perfData.layout);
        {% endif %}
        
        {% if charts.predictions_scatter %}
        var scatterData = {{ charts.predictions_scatter|safe }};
        Plotly.newPlot('scatter-chart', scatterData.data, scatterData.layout);
        {% endif %}
    </script>
    {% endif %}
    
    {% else %}
    <div class="alert alert-warning">
        <h5>No evaluation results available</h5>
        <p>Please ensure models and dataset are loaded properly before running evaluation.</p>
    </div>
    {% endif %}
    
    <div class="row mt-3">
        <div class="col-12">
            <a href="{{ url_for('evaluate') }}" class="btn btn-info">Run Another Evaluation</a>
            <a href="{{ url_for('index') }}" class="btn btn-secondary">Back to Dashboard</a>
        </div>
    </div>
</div>
{% endblock %}